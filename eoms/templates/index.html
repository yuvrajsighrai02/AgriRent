<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}AgriRent | Agriculture Equipment Rental{% endblock %}</title>
  <link rel="icon" href="{{ url_for('static', filename='images/logo/favicon.png') }}" type="image/png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="https://kit.fontawesome.com/e832c2aeff.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@eonasdan/tempus-dominus@6.9.4/dist/css/tempus-dominus.min.css">
  <link href="{{ url_for('static', filename='css/index.css') }}" rel="stylesheet">
  {% block css %}{% endblock %}
  <style>
    .goog-te-banner-frame.skiptranslate {
      display: none !important;
    }

    body {
      top: 0px !important;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    main {
        flex: 1;
    }

    #google_translate_element {
      padding: 0;
    }

    .goog-te-combo {
      border-radius: 5px;
      padding: 5px 8px;
      border: 1px solid #ced4da;
    }

    .modal-header {
      background-color: #2E7D32;
      color: white;
    }

    .modal-header .btn-close {
      filter: invert(1) grayscale(100%) brightness(200%);
    }

    .modal-body .form-control:focus {
      border-color: #2E7D32;
      box-shadow: 0 0 0 0.25rem rgba(46, 125, 50, 0.25);
    }

    .modal-footer a {
      color: #2E7D32;
    }
    
    .footer-link {
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        transition: color 0.3s;
    }

    .footer-link:hover {
        color: #ffffff;
    }

  </style>
</head>

<body>
  <header class="shadow-sm">
    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
      <div class="container d-flex justify-content-between">
        <a class="navbar-brand d-flex align-items-center" href="{{ url_for('home') }}">
          <img src="{{ url_for('static', filename='images/logo/logo_component.svg.png') }}" alt="AgriRent Logo"
            style="width: 50px;">
          <span class="ms-2 fw-bold text-success fs-4">AgriRent</span>
        </a>
        <form class="d-none d-md-block" action="{{ url_for('search_equipment') }}" method="get">
          <div class="input-group">
            <input type="search" name="search" class="form-control rounded-start-pill"
              placeholder="Search equipment...">
            <button class="btn btn-success rounded-end-pill" type="submit"><i class="fa fa-search"></i></button>
          </div>
        </form>
        <div class="d-flex align-items-center gap-3">
          <div id="google_translate_element"></div>
          <a href="{{ url_for('view_stores') }}" class="text-dark"><i class="fa fa-store fs-5"></i></a>
          <a href="{{ url_for('view_cart') }}" class="position-relative text-dark">
            <i class="fa fa-shopping-cart fs-5"></i>
            {% if cart_item_count > 0 %}
            <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">{{ cart_item_count
              }}</span>
            {% endif %}
          </a>

          <!-- ==================== NOTIFICATION ICON FIX ==================== -->
          <!--  <a href="{{ url_for('messages') }}#b" class="position-relative text-dark">
            <i class="fa-solid fa-bell fs-5"></i>
            {% if notifications_count > 0 %}
            <span class="badge bg-warning position-absolute top-0 start-100 translate-middle">{{ notifications_count
              }}</span>
            {% endif %}
          </a>-->
          
          <!-- ==================== NOTIFICATION ICON FIX ==================== -->
          <!-- This icon will now only appear if the user is logged in -->
          {% if session.get('loggedin') %}
          <a href="{{ url_for('messages') }}#b" class="position-relative text-dark">
            <i class="fa-solid fa-bell fs-5"></i>
            {% if notifications_count > 0 %}
            <span class="badge bg-warning position-absolute top-0 start-100 translate-middle">{{ notifications_count
              }}</span>
            {% endif %}
          </a>
          {% endif %}
          <!-- ============================================================= -->

          <div class="dropdown">
            {% if session.get('loggedin') %}
            <a class="dropdown-toggle text-dark text-decoration-none d-flex align-items-center" href="#" id="userDropdown"
              data-bs-toggle="dropdown" aria-expanded="false">
              <img
                src="{{ url_for('static', filename='images/profile_pics/' + session.get('profile_picture', 'default.png')) }}"
                alt="Profile" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">

              {{ session['email'] }}
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              {% if session.role == 'customer' %}
              <li><a class="dropdown-item" href="{{url_for('mybooking')}}"><i class="fa-solid fa-book main-color mx-1"></i>Current Bookings</a></li>
              <li><a class="dropdown-item" href="{{url_for('allbooking')}}"><i class="fa-solid fa-list-check main-color mx-1"></i>Bookings History</a></li>
              <li><a class="dropdown-item" href="{{url_for('profile')}}"><i class="fa fa-user main-color mx-1"></i>Profile</a></li>
              <li><a class="dropdown-item" href="{{url_for('change_password')}}"><i class="fa fa-key main-color mx-1"></i>Password</a></li>
              <li><a class="dropdown-item" href="{{ url_for('post_testimonial') }}"><i class="fa-solid fa-comment-dots main-color mx-1"></i>Post a Testimonial</a></li>
              {% else %}
              <li><a class="dropdown-item" href="{{url_for('dashboard')}}"><i class="fa-solid fa-tachometer-alt main-color mx-1"></i>Go to Dashboard</a></li>
              <li><a class="dropdown-item" href="{{url_for('profile')}}"><i class="fa fa-user main-color mx-1"></i>Profile</a></li>
              <li><a class="dropdown-item" href="{{url_for('change_password')}}"><i class="fa fa-key main-color mx-1"></i>Password</a></li>
              {% endif %}
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="{{url_for('logout')}}"><i class="fa fa-right-from-bracket main-color mx-1"></i>Logout</a></li>
            </ul>
            {% else %}
            <button type="button" class="btn btn-outline-success" data-bs-toggle="modal"
              data-bs-target="#loginModal">Login</button>
            <a href="{{ url_for('register') }}" class="btn btn-success">Register</a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>
    <!-- Bottom Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
      <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('home') }}">Home</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('view_promotion') }}">Promotions</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white" href="#" role="button"
                data-bs-toggle="dropdown">Equipment</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{{ url_for('search_equipment') }}">All Equipment</a></li>
                {% for category in category_options %}
                <li><a class="dropdown-item"
                    href="{{ url_for('view_equipment_by_category', category_code=category.category_code) }}">{{
                    category.name }}</a></li>
                {% endfor %}
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('view_stores') }}">Branches</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('view_news_list') }}">News</a></li>
            <!--<li class="nav-item"><a class="nav-link text-white" href="{{ url_for('contact') }}">Contact</a></li> -->
            <li class="nav-item"><a class="nav-link text-white" href="{{ url_for('about') }}">About</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <main class="container py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <!-- Enhanced Footer -->
<footer class="bg-dark text-white pt-5 pb-4">
    <div class="container text-center text-md-start">
        <div class="row">
            <!-- AgriRent Section -->
            <div class="col-md-4 col-lg-4 col-xl-4 mx-auto mb-4">
                <h5 class="text-uppercase fw-bold mb-4 text-success">AgriRent</h5>
                <p class="text-white-50">
                    Your one-stop solution for agricultural equipment rental. We are committed to boosting your farm productivity with our reliable and efficient services.
                </p>
            </div>

            <!-- Quick Links Section -->
            <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                <h5 class="text-uppercase fw-bold mb-4 text-success">Quick Links</h5>
                <p><a href="{{ url_for('home') }}" class="footer-link">Home</a></p>
                <p><a href="{{ url_for('search_equipment') }}" class="footer-link">Equipments</a></p>
                <p><a href="{{ url_for('about') }}" class="footer-link">About Us</a></p>
                <p><a href="{{ url_for('t_and_c') }}" class="footer-link">Terms</a></p>
            </div>

            <!-- Contact Section -->
            <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mb-4">
                <h5 class="text-uppercase fw-bold mb-4 text-success">Contact</h5>
                <p class="text-white-50"><i class="fas fa-phone me-3"></i> 9801234568</p>
                <p class="text-white-50"><i class="fas fa-envelope me-3"></i> agrirent@gmail.com</p>
                <p class="text-white-50"><i class="fas fa-map-marker-alt me-3"></i> 123 AgriRent Durg, Chhattisgarh</p>
            </div>

            <!-- Follow Us Section -->
            <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                <h5 class="text-uppercase fw-bold mb-4 text-success">Follow Us</h5>
                <div>
                    <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
        </div>
        
        <!-- Copyright -->
        <div class="text-center p-3 border-top border-secondary mt-4">
            <p class="mb-0 text-white-50">&copy; 2025 AgriRent. All Rights Reserved.</p>
        </div>
    </div>
</footer>


  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="loginModalLabel">Login to AgriRent</h5><button type="button" class="btn-close"
            data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="loginModalForm">
            <div class="mb-3"><label for="modalEmail" class="form-label">Email address</label><input type="email"
                class="form-control" id="modalEmail" name="email" required></div>
            <div class="mb-3"><label for="modalPassword" class="form-label">Password</label><input type="password"
                class="form-control" id="modalPassword" name="password" required></div>
            <div id="loginModalError" class="text-danger mb-3" style="display: none;"></div>
            <div class="d-grid"><button type="submit" class="btn btn-success btn-lg">Login</button></div>
          </form>
        </div>
        <div class="modal-footer justify-content-between">
          <div><a href="{{ url_for('reset_password') }}">Forgot password?</a></div>
          <div><span>Don't have an account?</span><a href="{{ url_for('register') }}">Register</a></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script type="text/javascript">
    function googleTranslateElementInit() { new google.translate.TranslateElement({ pageLanguage: 'en' }, 'google_translate_element'); }
  </script>
  <script type="text/javascript"
    src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <script>
    setTimeout(() => { document.querySelectorAll('.alert').forEach(alert => alert.remove()); }, 4000);

    document.addEventListener('DOMContentLoaded', function () {
      const loginForm = document.getElementById('loginModalForm');
      const errorDiv = document.getElementById('loginModalError');

      if (loginForm) {
        loginForm.addEventListener('submit', function (event) {
          event.preventDefault();
          errorDiv.style.display = 'none';
          const formData = new FormData(loginForm);
          fetch("{{ url_for('ajax_login') }}", { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                window.location.href = data.redirect;
              } else {
                errorDiv.textContent = data.message || 'An error occurred.';
                errorDiv.style.display = 'block';
              }
            })
            .catch(error => {
              console.error('Error:', error);
              errorDiv.textContent = 'A network error occurred. Please try again.';
              errorDiv.style.display = 'block';
            });
        });
      }
    });
  </script>

  {% block js %}{% endblock %}
</body>

</html>
