<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!---------- Bootstrap CSS ---------->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!---------- Bootstrap Icons ---------->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">

  <link href="../static/css/index.css" rel="stylesheet">
  <link href="../static/css/dashboard/index.css" rel="stylesheet">

  <script src="https://kit.fontawesome.com/e832c2aeff.js" crossorigin="anonymous"></script>

  <title>{% block title %}{% endblock %}</title>

  <style>
    :root {
      --main-color: #28a745;
      --secondary-color: #f8f9fa;
      --accent-color: #ffc107;
      --dark-color: #343a40;
      --light-color: #f8f9fa;
      --sidebar-width: 250px;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f5f5;
    }
    
    .navbar {
      background-color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 0.5rem 0;
    }
    
    .logo {
      height: 40px;
      transition: transform 0.3s;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }
    
    .main-color {
      color: var(--main-color);
    }
    
    .right-nav a {
      color: var(--dark-color);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      padding: 0.5rem 1rem;
      border-radius: 4px;
    }
    
    .right-nav a:hover {
      color: var(--main-color);
      background-color: rgba(40, 167, 69, 0.1);
    }
    
    /* Sidebar styles */
    #sidebar {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      padding: 10px;
      height: 100%;
    }
    
    .accordion-item {
      border: none;
      margin-bottom: 5px;
    }
    
    .accordion-button {
      border-radius: 6px !important;
      padding: 12px 15px;
      font-weight: 500;
      color: var(--dark-color);
      background-color: transparent;
      transition: all 0.3s;
    }
    
    .accordion-button:not(.collapsed) {
      color: white;
      background-color: var(--main-color);
      box-shadow: none;
    }
    
    .accordion-button:not(.collapsed) i {
      color: white !important;
    }
    
    .accordion-button:hover {
      background-color: rgba(40, 167, 69, 0.1);
    }
    
    .accordion-button:focus {
      box-shadow: none;
    }
    
    .accordion-body {
      padding: 0.5rem 1rem;
    }
    
    .sidebar-link {
      color: var(--dark-color);
      text-decoration: none;
      display: block;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.3s;
      margin: 3px 0;
    }
    
    .sidebar-link:hover, .sidebar-link.active {
      background-color: rgba(40, 167, 69, 0.1);
      color: var(--main-color);
    }
    
    .sidebar-link.active {
      font-weight: 500;
    }
    
    .sidebar-link i {
      width: 20px;
      text-align: center;
    }
    
    /* Main content area */
    .main-content {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
      padding: 20px;
      min-height: calc(100vh - 150px);
    }
    
    /* Notifications badge */
    .notifications.badge {
      font-size: 0.65rem;
      padding: 0.35em 0.5em;
      vertical-align: middle;
    }
    
    /* Alert messages */
    .alert {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* Modal styles */
    .modal-header {
      background-color: var(--main-color);
      color: white;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .col-md-2 {
        width: 100%;
        margin-bottom: 20px;
      }
      
      .col-md-10 {
        width: 100%;
      }
      
      .navbar {
        padding: 10px 0;
      }
    }
  </style>

  {% block css %}
  {% endblock %}
</head>

<body>
  <div class="container-fluid">
    <!---------- Navbar ---------->
    <div class="row">
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a class="navbar-brand" href="{{url_for('home')}}">
            <img src="{{ url_for('static', filename='images/logo/logo_component.svg.png') }}" alt="logo" class="logo">
          </a>
          
          {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
          {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endfor %}
          {% endif %}
          {% endwith %}
          
          <div class="d-flex align-items-center">
            {% if session.store_id %}
            <div class="me-3 main-color" style="font-weight: 600;">
              <i class="fas fa-store me-1"></i> {{session.store_name}}
            </div>
            {% endif %}
            
            {% if session['loggedin'] %}
            <a href="{{url_for('logout')}}" class="btn btn-outline-danger btn-sm">
              <i class="fa fa-right-from-bracket me-1"></i>Logout
            </a>
            {% else %}
            <a href="{{url_for('login')}}" class="btn btn-outline-success btn-sm">
              <i class="fa fa-user me-1"></i>Login
            </a>
            {% endif %}
          </div>
        </div>
      </nav>
    </div>

    <!---------- Content Field ---------->
    <div class="row mt-3 mb-4">
      <!---------- Sidebar ---------->
      <div class="col-md-2 d-none d-md-block">
        <div class="accordion accordion-flush" id="sidebar">
          <!---------- Dashboard Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <a href="{{ url_for('dashboard') }}"
                class="text-decoration-none {{ 'active' if request.path == url_for('dashboard') else '' }}">
                <button class="accordion-button collapsed sidebar-link" type="button">
                  <i class="bi bi-speedometer main-color"></i>
                  &nbsp;
                  Dashboard
                </button>
              </a>
            </h2>
          </div>
          
          <!---------- Message Sidebar ---------->
          {% if session['role'] in ['staff'] %}
          <div class="accordion-item">
            <h2 class="accordion-header">
              <a href="{{ url_for('staff_messages') }}"
                class="text-decoration-none {{ 'active' if 'messages' in request.path else '' }}">
                <button class="accordion-button collapsed sidebar-link" type="button">
                  <i class="bi bi-chat-dots-fill main-color"></i>
                  &nbsp;
                  Messages&nbsp;<span class="notifications badge text-bg-danger">{{ notifications_count if
                    notifications_count > 0 else '' }}</span>
                </button>
              </a>
            </h2>
          </div>
          {% endif %}
          
          <!---------- Administration Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed sidebar-link" type="button" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapse-store">
                <i class="bi bi-people-fill main-color"></i>
                &nbsp;
                Administration
              </button>
            </h2>
            <div id="panelsStayOpen-collapse-store"
              class="accordion-collapse collapse {% if request.path in [url_for('stores'), url_for('staff'), url_for('customers'), url_for('manage_testimonials')] %}show{% endif %}">
              <div class="accordion-body">
                {% if session['role'] != 'staff' %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('staff') else '' }}"
                    href="{{ url_for('staff') }}">
                    <i class="bi bi-person-badge-fill"></i>
                    &nbsp;
                    Staff
                  </a>
                </div>
                {% endif %}

                {% if session['role'] == 'nmgr' or session['role'] == 'admin' %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('stores') else '' }}"
                    href="{{ url_for('stores') }}">
                    <i class="bi bi-house-door"></i>
                    &nbsp;
                    Store
                  </a>
                </div>
                {% endif %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('customers') else '' }}"
                    href="{{ url_for('customers') }}">
                    <i class="bi bi-people"></i>
                    &nbsp;
                    Customer
                  </a>
                </div>

                {% if session['role'] in ['admin', 'nmgr', 'lmgr'] %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('manage_testimonials') else '' }}"
                    href="{{ url_for('manage_testimonials') }}">
                    <i class="bi bi-chat-quote-fill"></i>
                    &nbsp;
                    Testimonials
                  </a>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          
          <!---------- Equipments Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed sidebar-link" type="button" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapse-equipments">
                <i class="bi bi-archive-fill main-color"></i>
                &nbsp;
                Equipment
              </button>
            </h2>
            <div id="panelsStayOpen-collapse-equipments"
              class="accordion-collapse collapse {% if request.path in [url_for('category'), url_for('products'), url_for('machines'), url_for('equipment_returned_today'), url_for('manage_promotion'), url_for('view_inventory')] %}show{% endif %}">
              <div class="accordion-body">
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('category') else '' }}"
                    href="{{ url_for('category') }}">
                    <i class="bi bi-card-list"></i>
                    &nbsp;
                    Category
                  </a>
                </div>
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('products') else '' }}"
                    href="{{ url_for('products') }}">
                    <i class="bi bi-basket"></i>
                    &nbsp;
                    Product
                  </a>
                </div>

                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('machines') else '' }}"
                    href="{{ url_for('machines') }}">
                    <i class="bi bi-gear-wide-connected"></i>
                    &nbsp;
                    Machine
                  </a>
                </div>
                {% if session['role'] != 'staff' %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('manage_promotion') else '' }}"
                    href="{{ url_for('manage_promotion') }}">
                    <i class="bi bi-megaphone"></i>
                    &nbsp;
                    Promotion
                  </a>
                </div>
                {% endif %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('view_inventory') else '' }}"
                    href="{{ url_for('view_inventory') }}">
                    <i class="bi bi-house"></i>
                    &nbsp;
                    Inventory
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          <!---------- Order Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed sidebar-link" type="button" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapse-order">
                <i class="bi bi-bag-check-fill main-color"></i>
                &nbsp;
                Order
              </button>
            </h2>
            <div id="panelsStayOpen-collapse-order"
              class="accordion-collapse collapse {% if request.path in [url_for('bookings'), url_for('checkout'), url_for('equipment_returned_today'), url_for('get_equipment_returns_calendar')] %}show{% endif %}">
              <div class="accordion-body">
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('bookings') else '' }}"
                    href="{{ url_for('bookings') }}">
                    <i class="bi bi-journal-bookmark"></i>
                    &nbsp;
                    Bookings
                  </a>
                </div>
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('checkout') else '' }}"
                    href="{{ url_for('checkout') }}">
                    <i class="bi bi-cart-check"></i>
                    &nbsp;
                    Checkouts Today
                  </a>
                </div>
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('equipment_returned_today') else '' }}"
                    href="{{ url_for('equipment_returned_today') }}">
                    <i class="bi bi-calendar-check"></i>
                    &nbsp;
                    Returns Today
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          {% if session['role'] != 'staff' %}
          <!---------- Report Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed sidebar-link" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapse-report">
                <i class="bi bi-file-earmark-bar-graph-fill main-color"></i>
                &nbsp;
                Report
              </button>
            </h2>
            <div id="panelsStayOpen-collapse-report"
              class="accordion-collapse collapse {% if request.path in [url_for('financial_hire_damage_reports'), url_for('stock_order_store_reports'), url_for('users_report')] %}show{% endif %}">
              <div class="accordion-body">
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('financial_hire_damage_reports') else '' }}"
                    href="{{ url_for('financial_hire_damage_reports') }}">
                    <i class="bi bi-bar-chart-line"></i>
                    &nbsp;
                    Financial/Hire/Damage
                  </a>
                </div>
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('stock_order_store_reports') else '' }}"
                    href="{{ url_for('stock_order_store_reports') }}">
                    <i class="bi bi-bar-chart-steps"></i>
                    &nbsp;
                    Stock/Order
                  </a>
                </div>
                {% if session['role'] == 'admin' %}
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('users_report') else '' }}"
                    href="{{ url_for('users_report') }}">
                    <i class="bi bi-pie-chart"></i>
                    &nbsp;
                    Users
                  </a>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
          {% endif %}
          
          {% if session['role'] != 'staff' %}
          <!---------- News Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <a href="{{url_for('manage_news')}}" class="text-decoration-none">
                <button class="accordion-button collapsed sidebar-link" type="button">
                  <i class="bi bi-newspaper main-color"></i>
                  &nbsp;
                  News
                </button>
              </a>
            </h2>
          </div>
          {% endif %}
          
          <!---------- Settings Sidebar ---------->
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed sidebar-link" type="button" data-bs-toggle="collapse"
                data-bs-target="#panelsStayOpen-collapse-settings">
                <i class="bi bi-gear-fill main-color"></i>
                &nbsp;
                Settings
              </button>
            </h2>
            <div id="panelsStayOpen-collapse-settings"
              class="accordion-collapse collapse {% if request.path in [url_for('profile'), url_for('change_password')] %}show{% endif %}">
              <div class="accordion-body">
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('profile') else '' }}"
                    href="{{ url_for('profile') }}">
                    <i class="bi bi-person"></i>
                    &nbsp;
                    Profile
                  </a>
                </div>
                <div class="row">
                  <a class="p-1 rounded sidebar-link {{ 'active' if request.path == url_for('change_password') else '' }}"
                    href="{{ url_for('change_password') }}">
                    <i class="bi bi-lock"></i>
                    &nbsp;
                    Password
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!---------- Main Content ---------->
      <div class="col-md-10">
        <div class="main-content">
          {% block content %}
          {% endblock %}
        </div>
      </div>

      <!---------- message modal ---------->
      <div class="modal fade" id="msgModal" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Messages</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="message-body">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!---------- Footer ---------->
    <!-- Enhanced Footer -->
    <footer class="bg-dark text-white pt-5 pb-4">
      <div class="container text-center text-md-start">
        <div class="row">
          <!-- AgriRent Section -->
          <div class="col-md-4 col-lg-4 col-xl-4 mx-auto mb-4">
            <h5 class="text-uppercase fw-bold mb-4 text-success">AgriRent</h5>
            <p class="text-white-50">
              Your one-stop solution for agricultural equipment rental. We are committed to boosting your farm
              productivity with our reliable and efficient services.
            </p>
          </div>

          <!-- Quick Links Section -->
          <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
            <h5 class="text-uppercase fw-bold mb-4 text-success">Quick Links</h5>
            <p><a href="{{ url_for('home') }}" class="text-white-50 text-decoration-none">Home</a></p>
            <p><a href="{{ url_for('search_equipment') }}" class="text-white-50 text-decoration-none">Equipments</a></p>
            <p><a href="{{ url_for('about') }}" class="text-white-50 text-decoration-none">About Us</a></p>
            <p><a href="{{ url_for('t_and_c') }}" class="text-white-50 text-decoration-none">Terms</a></p>
          </div>

          <!-- Contact Section -->
          <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mb-4">
            <h5 class="text-uppercase fw-bold mb-4 text-success">Contact</h5>
            <p class="text-white-50"><i class="fas fa-phone me-3"></i> 9801234568</p>
            <p class="text-white-50"><i class="fas fa-envelope me-3"></i> agrirent@gmail.com</p>
            <p class="text-white-50"><i class="fas fa-map-marker-alt me-3"></i> 123 AgriRent Lane, Farmville</p>
          </div>

          <!-- Follow Us Section -->
          <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
            <h5 class="text-uppercase fw-bold mb-4 text-success">Follow Us</h5>
            <div>
              <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-facebook-f"></i></a>
              <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-twitter"></i></a>
              <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-instagram"></i></a>
              <a href="#" class="btn btn-outline-light btn-floating m-1" role="button"><i class="fab fa-whatsapp"></i></a>
            </div>
          </div>
        </div>

        <!-- Copyright -->
        <div class="text-center p-3 border-top border-secondary mt-4">
          <p class="mb-0 text-white-50">&copy; 2025 AgriRent. All Rights Reserved.</p>
        </div>
      </div>
    </footer>
  </div>

  <!---------- Bootstrap JS ---------->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <!---------- jQuery JS ---------->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <!---------- Custom JS ---------->
  <script src="../static/js/dashboard/index.js"></script>

  <script>
    setTimeout(function () {
      var alerts = document.querySelectorAll('.alert');
      alerts.forEach(function (alert) {
        if (alert) {
          alert.remove();
        }
      });
    }, 4000);

    $(document).ready(function () {
      $('.editmsg').click(function () {
        var id = $(this).data('id');

        $.ajax({
          url: '/messages',
          type: 'post',
          data: { id: id },
          success: function (data) {
            $('.message-body').html(data.htmlresponse);
            $('#msgModal').modal('show');
          },
          error: function (error) {
            console.log('Error fetching data:', error);
          }
        });
      });

      $('#submitMsg').click(function (event) {
        event.preventDefault(); // Prevent the default form submission

        $.ajax({
          url: $('#messageform').attr('action'),
          type: $('#messageform').attr('method'),
          data: $('#messageform').serialize(),
          success: function (response) {
            console.log('AJAX success response:', response);
          },
          error: function (error) {
            // Handle any errors
            console.log('Form submission failed!', error);
          }
        });
      });

      $.ajax({
        url: '/notifications',
        type: 'post',
        success: function (data) {
          $('.notifications').html(data.response);
        },
        error: function (error) {
          console.log('Error fetching data:', error);
        }
      });
    });
  </script>
  {% block js %}
  {% endblock %}
</body>

</html>